import{_ as i}from"./chunks/vercel-1.BWiYCwZn.js";import{_ as e,c as a,o as s,ah as l}from"./chunks/framework.C1X3fnKc.js";const o="/assets/netlify-1.CBH5jdAK.png",r="/assets/netlify-2.CoU6-6Qj.png",n="/assets/netlify-3.BRAuDkNv.png",d="/assets/netlify-4.BPwUhUpI.png",c="/assets/netlify-5.BSv5GDZV.png",p="/assets/hugging-1.qykHscdz.png",h="/assets/hugging-2.BZLt3AFG.png",k="/assets/hugging-3.BE7bV_x9.png",g="/assets/hugging-4.IZDT8YRp.png",u="/assets/hugging-5.Cw4bsoD7.png",b="/assets/hugging-6.CxsVPwFh.png",m="/assets/hugging-7.ey7RVDUh.png",f="/assets/hugging-8.bn1zLPri.png",y="/assets/hugging-9.BfxLMyMQ.png",T=JSON.parse('{"title":"云函数部署","description":"","frontmatter":{},"headers":[],"relativePath":"backend.md","filePath":"backend.md","lastUpdated":null}'),E={name:"backend.md"};function F(v,t,w,_,C,B){return s(),a("div",null,t[0]||(t[0]=[l(`<h1 id="云函数部署" tabindex="-1">云函数部署 <a class="header-anchor" href="#云函数部署" aria-label="Permalink to &quot;云函数部署&quot;">​</a></h1><table tabindex="0"><thead><tr><th><div style="width:6em;">部署方式</div></th><th>推荐度</th><th>描述</th></tr></thead><tbody><tr><td><a href="#腾讯云一键部署">腾讯云一键部署</a></td><td>★☆☆☆☆</td><td>虽然方便，但是仅支持按量计费环境——也就是说，<strong>一键部署的环境，当免费资源用尽后，将会产生费用</strong>。且按量计费环境无法切换为包年包月环境。免费额度数据库读操作数只有 500 次 / 天，<strong>无法支撑 Twikoo 的运行需求</strong>。</td></tr><tr><td><a href="#腾讯云手动部署">腾讯云手动部署</a></td><td>★★☆☆☆</td><td>手动部署到腾讯云云开发环境，在中国大陆访问速度较快。需要付费购买环境才能部署。</td></tr><tr><td><a href="#腾讯云命令行部署">腾讯云命令行部署</a></td><td>★☆☆☆☆</td><td>仅针对有 Node.js 经验的开发者。</td></tr><tr><td><a href="#vercel-部署">Vercel 部署</a></td><td>★★★☆☆</td><td>适用于想要免费部署的用户，在中国大陆访问速度较慢甚至无法访问，绑定自己的域名可以提高访问速度。</td></tr><tr><td><a href="#railway-部署">Railway 部署</a></td><td>★★☆☆☆</td><td>有免费额度但不足以支持一个月连续运行，部署简单，适合全球访问。</td></tr><tr><td><a href="#zeabur-部署">Zeabur 部署</a></td><td>★☆☆☆☆</td><td>需要绑定支付宝或信用卡，部署简单，适合中国大陆访问，免费计划环境随时可能会被删除。</td></tr><tr><td><a href="#netlify-部署">Netlify 部署</a></td><td>★★★★☆</td><td>有充足的免费额度，中国大陆访问速度不错。</td></tr><tr><td><a href="#hugging-face-部署">Hugging Face 部署</a></td><td>★★★★☆</td><td>免费，中国大陆访问速度不错。允许通过 Cloudflare Tunnels 自定义域名。</td></tr><tr><td><a href="#aws-lambda-部署">AWS Lambda 部署</a></td><td>★★★☆☆</td><td>全球最大的云平台，适合已经使用 AWS 全家桶的用户。</td></tr><tr><td><a href="#cloudflare-workers-部署">Cloudflare workers 部署</a></td><td>★★☆☆☆</td><td>部署需使用命令行，冷启动时间较短，功能有部分限制。</td></tr><tr><td><a href="#私有部署">私有部署</a></td><td>★★☆☆☆</td><td>适用于有服务器的用户，需要自行申请 HTTPS 证书。</td></tr><tr><td><a href="#私有部署-docker">私有部署 (Docker)</a></td><td>★★★☆☆</td><td>适用于有服务器的用户，需要自行申请 HTTPS 证书。</td></tr></tbody></table><h2 id="腾讯云一键部署" tabindex="-1">腾讯云一键部署 <a class="header-anchor" href="#腾讯云一键部署" aria-label="Permalink to &quot;腾讯云一键部署&quot;">​</a></h2><ol><li>点击以下按钮将 Twikoo 一键部署到云开发<br><a href="https://console.cloud.tencent.com/tcb/env/index?action=CreateAndDeployCloudBaseProject&amp;appUrl=https%3A%2F%2Fgithub.com%2Fimaegoo%2Ftwikoo&amp;branch=main" target="_blank" rel="noreferrer"><img src="https://main.qcloudimg.com/raw/67f5a389f1ac6f3b4d04c7256438e44f.svg" alt="部署到云开发"></a></li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noreferrer">环境-登录授权</a>，启用“匿名登录”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noreferrer">环境-安全配置</a>，将网站域名添加到“WEB安全域名”</li></ol><h2 id="腾讯云手动部署" tabindex="-1">腾讯云手动部署 <a class="header-anchor" href="#腾讯云手动部署" aria-label="Permalink to &quot;腾讯云手动部署&quot;">​</a></h2><p>如果您打算部署到一个现有的云开发环境，请直接从第 3 步开始。</p><ol><li>进入<a href="https://curl.qcloud.com/KnnJtUom" target="_blank" rel="noreferrer">云开发CloudBase</a>活动页面，滚动到“新用户专享”部分，选择适合的套餐，点击“立即购买”，按提示创建好环境。</li></ol><div class="tip custom-block"><p class="custom-block-title">提示</p><ul><li>推荐创建上海环境。如选择广州环境，需要在 <code>twikoo.init()</code> 时额外指定环境 <code>region: &quot;ap-guangzhou&quot;</code></li><li>环境名称自由填写</li><li>推荐选择计费方式<code>包年包月</code>，套餐版本<code>基础版 1</code>，超出免费额度不会收费</li><li>如果提示选择“应用模板”，请选择“空模板”</li></ul></div><ol start="2"><li>进入<a href="https://console.cloud.tencent.com/tcb/" target="_blank" rel="noreferrer">云开发控制台</a><br></li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noreferrer">环境-登录授权</a>，启用“匿名登录”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noreferrer">环境-安全配置</a>，将网站域名添加到“WEB安全域名”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/scf/index" target="_blank" rel="noreferrer">环境-云函数</a>，点击“新建云函数”</li><li>函数名称请填写：<code>twikoo</code>，创建方式请选择：<code>空白函数</code>，运行环境请选择：<code>Nodejs 16.13</code>，函数内存请选择：<code>128MB</code>，点击“下一步”</li><li>清空输入框中的示例代码，复制以下代码、粘贴到“函数代码”输入框中，点击“确定”</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.main </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;twikoo-func&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).main</span></span></code></pre></div><ol start="8"><li>创建完成后，点击“twikoo&quot;进入云函数详情页，进入“函数代码”标签，点击“文件 - 新建文件”，输入 <code>package.json</code>，回车</li><li>复制以下代码、粘贴到代码框中，点击“保存并安装依赖”</li></ol><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;twikoo-func&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.6.42&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }</span></span></code></pre></div><h2 id="腾讯云命令行部署" tabindex="-1">腾讯云命令行部署 <a class="header-anchor" href="#腾讯云命令行部署" aria-label="Permalink to &quot;腾讯云命令行部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><ul><li>请确保您已经安装了 <a href="https://nodejs.org/en/download/" target="_blank" rel="noreferrer">Node.js</a></li><li>请将命令、代码中“您的环境id”替换为您自己的环境id</li><li>第 7 步会弹出浏览器要求授权，需在有图形界面的系统下进行</li><li>请勿在 Termux 下操作。虽然可以部署成功，但是使用时会报错 <code>[FUNCTIONS_EXECUTE_FAIL] Error: EACCES: permission denied, open &#39;/var/user/index.js&#39;</code></li></ul></div><p>如果您打算部署到一个现有的云开发环境，请直接从第 3 步开始。</p><ol><li>进入<a href="https://curl.qcloud.com/KnnJtUom" target="_blank" rel="noreferrer">云开发CloudBase</a>活动页面，滚动到“新用户专享”部分，选择适合的套餐（一般 0 元套餐即可），点击“立即购买”，按提示创建好环境。</li><li>进入<a href="https://console.cloud.tencent.com/tcb/" target="_blank" rel="noreferrer">云开发控制台</a><br></li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noreferrer">环境-登录授权</a>，启用“匿名登录”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noreferrer">环境-安全配置</a>，将网站域名添加到“WEB安全域名”</li><li>克隆本仓库</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/twikoojs/twikoo.git</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 或 git clone https://e.coding.net/imaegoo/twikoo/twikoo.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> twikoo</span></span></code></pre></div><blockquote><p>如果您没有安装 Git，也可以从 <a href="https://github.com/twikoojs/twikoo/releases" target="_blank" rel="noreferrer">Release</a> 页面下载最新的 Source code<br> 如果您所在的地区访问 Github 速度慢，也可以尝试另一个仓库地址：<a href="https://imaegoo.coding.net/public/twikoo/twikoo/git" target="_blank" rel="noreferrer">https://imaegoo.coding.net/public/twikoo/twikoo/git</a></p></blockquote><ol start="6"><li>安装依赖项</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yarn</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 已安装 yarn 可以跳过此步</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><ol start="7"><li>授权云开发环境（此命令会弹出浏览器要求授权，需在有图形界面的系统下进行）</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span></span></code></pre></div><ol start="8"><li>自动部署</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 您的环境id</span></span></code></pre></div><h2 id="宝塔面板-部署" tabindex="-1">宝塔面板 部署 <a class="header-anchor" href="#宝塔面板-部署" aria-label="Permalink to &quot;宝塔面板 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>宝塔面板 (适用 9.2.0 及以上的版本)</p></div><p>前往 <a href="https://www.bt.cn/new/download.html" target="_blank" rel="noreferrer">宝塔面板官网</a>，选择正式版的脚本下载安装（如果已安装，请跳过此步）</p><ol><li>安装后登录宝塔面板，在左侧导航栏点击 Docker，首先进入会提示安装 Docker 服务，点击立即安装，按提示完成安装</li></ol><p><img src="https://github.com/user-attachments/assets/d15d3422-b2c0-4bd0-a889-4f275565d9cd" alt="20241010103723"></p><ol start="2"><li>完成安装后在应用商店中找到 Twikoo ，点击安装，配置域名、端口等基本信息即可完成安装</li></ol><p><img src="https://github.com/user-attachments/assets/fca433b3-5ba9-4424-af0e-4063df341833" alt="1730860915662"></p><p>注意：域名为非必填，如果填写了域名则通过【网站】-【反向代理】来管理，填写域名后不需要勾选【允许外部访问】，否则需要勾选后才可以通过端口访问</p><ol start="3"><li>安装后在浏览器输入上一步设置的域名或者 IP + 端口即可访问。</li></ol><h2 id="vercel-部署" tabindex="-1">Vercel 部署 <a class="header-anchor" href="#vercel-部署" aria-label="Permalink to &quot;Vercel 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Vercel 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>默认域名 <code>*.vercel.app</code> 在中国大陆访问速度较慢甚至无法访问，绑定自己的域名可以提高访问速度</p></div><p><a href="https://www.bilibili.com/video/BV1Fh411e7ZH" target="_blank" rel="noreferrer">查看视频教程</a></p><ol><li>申请 <a href="./mongodb-atlas.html">MongoDB Atlas</a> 账号，获取 MongoDB 连接字符串</li><li>申请 <a href="https://vercel.com/signup" target="_blank" rel="noreferrer">Vercel</a> 账号</li><li>点击以下按钮将 Twikoo 一键部署到 Vercel<br></li></ol><p><a href="https://vercel.com/import/project?template=https://github.com/twikoojs/twikoo/tree/main/src/server/vercel-min" target="_blank" rel="noreferrer"><img src="https://vercel.com/button" alt="Deploy"></a></p><ol start="4"><li>进入 Settings - Environment Variables，添加环境变量 <code>MONGODB_URI</code>，值为前面记录的数据库连接字符串</li><li>进入 Settings - Deployment Protection，设置 Vercel Authentication 为 Disabled，并 Save</li></ol><p><img src="`+i+'" alt=""></p><ol start="6"><li>进入 Deployments , 然后在任意一项后面点击更多（三个点） , 然后点击 Redeploy , 最后点击下面的 Redeploy</li><li>进入 Overview，点击 Domains 下方的链接，如果环境配置正确，可以看到 “Twikoo 云函数运行正常” 的提示</li><li>Vercel Domains（包含 <code>https://</code> 前缀，例如 <code>https://xxx.vercel.app</code>）即为您的环境 id</li></ol><h2 id="railway-部署" tabindex="-1">Railway 部署 <a class="header-anchor" href="#railway-部署" aria-label="Permalink to &quot;Railway 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Railway 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>请一定要创建 MongoDB，不创建 MongoDB 也能正常使用，但重新部署后数据会丢失！</p></div><ol><li>在 <a href="https://railway.app/dashboard" target="_blank" rel="noreferrer">Railway</a> 申请并登录账号，点击 New Project - Provision MongoDB，名称随意</li><li>打开 <a href="https://github.com/twikoojs/twikoo-zeabur" target="_blank" rel="noreferrer">twikoojs/twikoo-zeabur</a> 点击 fork 将仓库 fork 到自己的账号下</li><li>回到 Railway 点击 New - GitHub Repo - Configure GitHub App - 授权 GitHub - 选择刚才 fork 的仓库，等待部署完成</li><li>点开环境卡片 - Variables - New Variable，左边输入 <code>PORT</code> 右边输入 <code>8080</code> 然后点 Add</li><li>同样地，添加 MongoDB 相关环境变量 - New Variable - Add Reference - MONGO* - Add，重复步骤以添加 <code>MONGOHOST</code>、<code>MONGOPASSWORD</code>、<code>MONGOPORT</code>、<code>MONGOUSER</code> 和 <code>MONGO_URL</code> 环境变量。</li><li>点开环境卡片 - Settings - Environment - Domains，绑定一个域名（例如 <code>mytwikoo.up.railway.app</code>）</li><li>到博客配置文件中配置 envId 为 <code>https://</code> 加域名（例如 <code>https://mytwikoo.up.railway.app</code>）</li></ol><h2 id="zeabur-部署" tabindex="-1">Zeabur 部署 <a class="header-anchor" href="#zeabur-部署" aria-label="Permalink to &quot;Zeabur 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Zeabur 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>请一定要创建 MongoDB，不创建 MongoDB 也能正常使用，但重新部署后数据会丢失！</p></div><ol><li>在 <a href="https://dash.zeabur.com" target="_blank" rel="noreferrer">Zeabur</a> 申请并登录账号，点击部署新服务 - 部署其他服务 - 部署 MongoDB，名称随意</li><li>打开 <a href="https://github.com/twikoojs/twikoo-zeabur" target="_blank" rel="noreferrer">twikoojs/twikoo-zeabur</a> 点击 fork 将仓库 fork 到自己的账号下</li><li>回到 Zeabur 点击部署新服务 - 部署你的源代码 - 授权 GitHub - 选择刚才 fork 的仓库，名称随意</li></ol><blockquote><p><em>无需配置数据库连接字符串！ Zeabur 已自动配置</em></p></blockquote><ol start="4"><li>部署好后点开环境卡片 - 设置 - 域名，绑定一个域名（例如 <code>mytwikoo.zeabur.app</code>）</li><li>到博客配置文件中配置 envId 为 <code>https://</code> 加域名（例如 <code>https://mytwikoo.zeabur.app</code>）</li></ol><h2 id="netlify-部署" tabindex="-1">Netlify 部署 <a class="header-anchor" href="#netlify-部署" aria-label="Permalink to &quot;Netlify 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Netlify 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>Netlify 免费等级（Functions Level 0）支持每月 125,000 请求次数和 100 小时函数计算时长</p></div><ol><li>申请 <a href="./mongodb-atlas.html">MongoDB Atlas</a> 账号，获取 MongoDB 连接字符串</li><li>申请并登录 <a href="https://app.netlify.com" target="_blank" rel="noreferrer">Netlify</a> 账号，创建一个 Team</li><li>打开 <a href="https://github.com/twikoojs/twikoo-netlify" target="_blank" rel="noreferrer">twikoojs/twikoo-netlify</a> 点击 fork 将仓库 fork 到自己的账号下</li><li>回到 Netlify，点击 Add new site - Import an existing project</li></ol><p><img src="'+o+'" alt=""></p><ol start="5"><li>点击 Deploy with GitHub，如果未授权 GitHub 账号，先授权，然后选择前面 fork 的 twikoo-netlify 项目</li></ol><p><img src="'+r+'" alt=""></p><ol start="6"><li>点击 Add environment variables - New variable，Key 输入 <code>MONGODB_URI</code>，Value 输入前面记录的数据库连接字符串，点击 Deploy twikoo-netlify</li></ol><p><img src="'+n+'" alt=""></p><ol start="7"><li>部署完成后，点击 Domain settings - 右侧 Options - Edit site name，可以设置属于自己的三级域名（<code>https://xxx.netlify.app</code>）</li></ol><p><img src="'+d+'" alt=""></p><ol start="8"><li>进入 Site overview，点击上方的链接，如果环境配置正确，可以看到 “Twikoo 云函数运行正常” 的提示</li></ol><p><img src="'+c+'" alt=""></p><ol start="9"><li>云函数地址（包含 <code>https://</code> 前缀和 <code>/.netlify/functions/twikoo</code> 后缀，例如 <code>https://xxx.netlify.app/.netlify/functions/twikoo</code>）即为您的环境 id</li></ol><h2 id="hugging-face-部署" tabindex="-1">Hugging Face 部署 <a class="header-anchor" href="#hugging-face-部署" aria-label="Permalink to &quot;Hugging Face 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Hugging Face 部署的环境，由于默认的邮件端口被屏蔽，无法使用邮件功能。详见 <a href="https://github.com/twikoojs/twikoo/issues/638" target="_blank" rel="noreferrer">twikoo/issues/638</a></p></div><ol><li>申请 <a href="./mongodb-atlas.html">MongoDB Atlas</a> 账号，获取 MongoDB 连接字符串</li><li>申请 <a href="https://huggingface.co/join" target="_blank" rel="noreferrer">Hugging Face</a> 账号</li><li>登录，点击 Spaces - Create new Space</li></ol><p><img src="'+p+'" alt=""></p><ol start="4"><li>输入 Space name，Select the Space SDK 选择 Docker，Choose a Docker template 选择 Blank，Space hardware 选择 FREE，选择 Public，点击 Create Space</li></ol><p><img src="'+h+'" alt=""></p><ol start="5"><li>进入刚刚创建的 Space，点击页面上方的 Settings，滚动到 Variables and secrets 部分，点击 New secret，Name 输入 <code>MONGODB_URI</code>，Value 输入前面记录的数据库连接字符串，点击 Save</li></ol><p><img src="'+k+'" alt=""></p><ol start="6"><li>点击页面上方的 Files - Add file - Create a new file</li></ol><p><img src="'+g+`" alt=""></p><ol start="7"><li>在 Name your file 中输入 <code>Dockerfile</code>，在 Edit 区域输入以下内容</li></ol><div class="language-Dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imaegoo/twikoo</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TWIKOO_PORT 7860</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 7860</span></span></code></pre></div><p><img src="`+u+'" alt=""></p><ol start="8"><li>点击 Commit new file to main</li><li>点击右上角 Settings 右方的菜单（三个点）图标 - Embed this Space，Direct URL 下的内容（例如 <code>https://xxx-xxx.hf.space</code>）即为您的环境 id</li></ol><p><img src="'+b+'" alt=""></p><h3 id="如果你需要自定义域名" tabindex="-1">如果你需要自定义域名 <a class="header-anchor" href="#如果你需要自定义域名" aria-label="Permalink to &quot;如果你需要自定义域名&quot;">​</a></h3><blockquote><p>自定义域名教程由 <a href="https://github.com/Hoshino-Yumetsuki" target="_blank" rel="noreferrer">Hoshino-Yumetsuki</a> 提供</p><p>ps：除了 <code>CF_ZERO_TRUST_TOKEN</code> 这个环境变量以外，其他环境变量的配置方式与上一步相同</p></blockquote><ol><li>申请 Cloudflare Zero Trust，关于申请方式请自行查找</li></ol><p><img src="'+m+'" alt=""></p><ol start="2"><li>添加一条隧道，连接方式选择 Cloudflared，名称任意</li></ol><p><img src="'+f+'" alt=""></p><ol start="3"><li>添加一个 Public Hostname，回源选择 HTTP，端口选择 8080</li><li>Clone Twikoo 仓库，找到 <code>src\\server\\hf-space</code></li><li>去 Hugging Face 创建一个 Space，然后 Clone 下来，将 hf-space 文件夹内的所有内容复制进去</li><li>在 Hugging Face Space 的设置中添加一个环境变量，变量名 <code>CF_ZERO_TRUST_TOKEN</code>，值是 Tunnels 给的令牌（删掉 <code>cloudflared.exe service install</code>，只保留令牌部分）</li></ol><p><img src="'+y+`" alt=""></p><ol start="7"><li>Push 到 Hugging Face Space 仓库</li></ol><h2 id="aws-lambda-部署" tabindex="-1">AWS Lambda 部署 <a class="header-anchor" href="#aws-lambda-部署" aria-label="Permalink to &quot;AWS Lambda 部署&quot;">​</a></h2><ol><li>注册 AWS 账号并配置 Terraform CLI。</li><li>如需使用托管的 MongoDB 数据库，可申请 <a href="./mongodb-atlas.html">MongoDB Atlas</a> 账号。</li><li>参考 <code>src/server/aws-lambda/terraform</code> 目录中 Terraform 代码创建 AWS 资源。</li><li>部署完成后，Terraform 会将 <code>lambda_function_url</code> 打印在屏幕上，您也可以使用 <code>terraform output</code> 获取这一 URL，如：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ terraform output</span></span>
<span class="line"><span>lambda_function_url = &quot;https://axtoiiithbcexamplegq7ozalu0cnkii.lambda-url.us-west-2.on.aws/&quot;</span></span></code></pre></div><p>该 URL 即为您的环境 ID，请记下这一 URL 用于前端配置。</p><h2 id="cloudflare-workers-部署" tabindex="-1">Cloudflare workers 部署 <a class="header-anchor" href="#cloudflare-workers-部署" aria-label="Permalink to &quot;Cloudflare workers 部署&quot;">​</a></h2><p>请参考 <a href="https://github.com/twikoojs/twikoo-cloudflare" target="_blank" rel="noreferrer">github.com/twikoojs/twikoo-cloudflare</a></p><h2 id="私有部署" tabindex="-1">私有部署 <a class="header-anchor" href="#私有部署" aria-label="Permalink to &quot;私有部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>私有部署的环境需配合 1.6.0 或以上版本的 twikoo.js 使用</p><p>私有部署对服务器系统没有要求，Windows、Ubuntu、CentOS、macOS 等常用系统均支持。</p><p>私有部署涉及终端操作、申请证书、配置反向代理或负载均衡等高级操作，如果对这些不太了解，建议优先选择其他方式部署。</p></div><ol><li>服务端下载安装 <a href="https://nodejs.org/zh-cn/" target="_blank" rel="noreferrer">Node.js</a></li><li>安装 Twikoo server: <code>npm i -g tkserver</code></li><li>根据需要配置环境变量，所有的环境变量都是可选的</li></ol><table tabindex="0"><thead><tr><th>名称</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td><code>MONGODB_URI</code></td><td>MongoDB 数据库连接字符串，不传则使用 lokijs</td><td><code>null</code></td></tr><tr><td><code>MONGO_URL</code></td><td>MongoDB 数据库连接字符串，不传则使用 lokijs</td><td><code>null</code></td></tr><tr><td><code>TWIKOO_DATA</code></td><td>lokijs 数据库存储路径</td><td><code>./data</code></td></tr><tr><td><code>TWIKOO_PORT</code></td><td>端口号</td><td><code>8080</code></td></tr><tr><td><code>TWIKOO_THROTTLE</code></td><td>IP 请求限流，当同一 IP 短时间内请求次数超过阈值将对该 IP 返回错误</td><td><code>250</code></td></tr><tr><td><code>TWIKOO_LOCALHOST_ONLY</code></td><td>为<code>true</code>时只监听本地请求，使得 nginx 等服务器反代之后不暴露原始端口</td><td><code>null</code></td></tr><tr><td><code>TWIKOO_LOG_LEVEL</code></td><td>日志级别，支持 <code>verbose</code> / <code>info</code> / <code>warn</code> / <code>error</code></td><td><code>info</code></td></tr><tr><td><code>TWIKOO_IP_HEADERS</code></td><td>在一些特殊情况下使用，如使用了 <code>CloudFlare CDN</code> 它会将请求 IP 写到请求头的 <code>cf-connecting-ip</code> 字段上，为了能够正确的获取请求 IP 你可以写成 <code>[&quot;headers.cf-connecting-ip&quot;]</code></td><td><code>[]</code></td></tr></tbody></table><ol start="4"><li>启动 Twikoo server: <code>tkserver</code></li><li>访问 <code>http://服务端IP:8080</code> 测试服务是否启动成功</li><li>配置前置代理实现 HTTPS 访问（可以用 Nginx、负载均衡或 Cloudflare 等）</li><li>到博客配置文件中配置 envId 为 <code>https://</code> 加域名（例如 <code>https://twikoo.yourdomain.com</code>）</li></ol><div class="tip custom-block"><p class="custom-block-title">提示</p><ol><li>Linux 服务器可以用 <code>nohup tkserver &gt;&gt; tkserver.log 2&gt;&amp;1 &amp;</code> 命令后台启动</li><li>数据默认在 data 目录，请注意定期备份数据</li><li>默认端口为8080，自定义端口使用可使用 <code>TWIKOO_PORT=1234 tkserver</code> 启动。</li><li>配置systemctl服务配合<code>TWIKOO_PORT=1234 tkserver</code>设置开机启动</li></ol></div><h2 id="私有部署-docker" tabindex="-1">私有部署 (Docker) <a class="header-anchor" href="#私有部署-docker" aria-label="Permalink to &quot;私有部署 (Docker)&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>私有部署的环境需配合 1.6.0 或以上版本的 twikoo.js 使用</p><p>私有部署涉及终端操作、申请证书、配置反向代理或负载均衡等高级操作，如果对这些不太了解，建议优先选择其他方式部署。</p></div><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> twikoo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TWIKOO_THROTTLE=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8080:8080</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${PWD}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/data:/app/data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> imaegoo/twikoo</span></span></code></pre></div><h3 id="docker-compose" tabindex="-1">Docker Compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;Docker Compose&quot;">​</a></h3><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  twikoo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">imaegoo/twikoo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">twikoo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">8080:8080</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      TWIKOO_THROTTLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./data:/app/data</span></span></code></pre></div>`,104)]))}const x=e(E,[["render",F]]);export{T as __pageData,x as default};
